# LlamaIndex å¯¦æˆ°ï¼šRe-Rankã€Hybrid Retrieval èˆ‡ Retrieval Orchestration (Week 3)

æœ¬å°ˆæ¡ˆå»¶çºŒå‰ä¸€é€±çš„å¯æŒä¹…åŒ– RAG æ¶æ§‹ï¼Œé€²ä¸€æ­¥èšç„¦åœ¨ **ã€Œç•¶å‘é‡æœå°‹å·²ä¸è¶³ä»¥æ”¯æ’é«˜å“è³ªæª¢ç´¢æ™‚ï¼Œæˆ‘å€‘è©²æ€éº¼åšï¼Ÿã€**  
Week 3 çš„æ ¸å¿ƒä¸»é¡Œæ˜¯ï¼š**é€²éšæª¢ç´¢å“è³ªå„ªåŒ–ï¼ˆRetrieval Quality Optimizationï¼‰**ã€‚

å…§å®¹æ¶µè“‹ **Re-Rankingã€Hybrid Retrievalï¼ˆBM25 + Denseï¼‰ã€Query Fusionã€ä»¥åŠ Retrieval Orchestration**ï¼Œå®Œæ•´å‘ˆç¾å¾ã€Œæ‰¾å¾—åˆ°ã€èµ°å‘ã€Œæ‰¾å¾—æº–ã€çš„å·¥ç¨‹æ¼”é€²è·¯å¾‘ã€‚

---

## ğŸ“… æ›´æ–°è³‡è¨Š
- **åˆç‰ˆæ—¥æœŸ**ï¼š2026.01.07
- **ç­†è¨˜ç‰ˆæœ¬**ï¼šv1.0.0
- **Notebook**ï¼š`week_3.ipynb`ï¼ˆFirst Releaseï¼‰

---

## ğŸš€ æ ¸å¿ƒé‡é»

### 1. Re-Rankingï¼šè®“ã€Œå‰å¹¾åã€çœŸçš„æœ‰æ„ç¾©
å‘é‡æœå°‹è§£æ±ºçš„æ˜¯ **Recall**ï¼Œä½†åœ¨å¯¦å‹™ç³»çµ±ä¸­ï¼Œ**Precision æ‰æ˜¯ä½¿ç”¨è€…é«”é©—çš„é—œéµ**ã€‚

æœ¬ç« æ·±å…¥æ¯”è¼ƒä¸‰ç¨®ä¸»æµ Re-Rank ç­–ç•¥ï¼š

#### ğŸ”¹ FlagEmbeddingRerankerï¼ˆLocal, Cross-Encoderï¼‰
- ä½¿ç”¨ **BAAI/bge-reranker-large**
- æ¡ç”¨ **Cross-Encoder æ¶æ§‹**ï¼ŒåŒæ™‚è®€å– Query + Document
- é©åˆï¼š
  - æœ¬åœ° GPU
  - é«˜éš±ç§éœ€æ±‚
  - ä¸å¸Œæœ›æ‰¿æ“” API æˆæœ¬çš„å ´æ™¯
- æ ¸å¿ƒå–æ¨ï¼š
  - ç²¾åº¦æ¥µé«˜
  - åƒ…é©åˆ rerank Top-Kï¼ˆ10â€“50 ç­†ï¼‰

#### ğŸ”¹ RankGPTï¼ˆLLM Listwise Rerankingï¼‰
- ä½¿ç”¨ LLM é€²è¡Œ **åˆ—è¡¨å¼é‡æ’åº**
- èƒ½ç†è§£èªæ„ç´°ç¯€ã€é‚è¼¯èˆ‡ä½¿ç”¨è€…æ„åœ–
- å®šä½ç‚ºï¼š
  - **Final Polish**
  - é«˜åƒ¹å€¼æŸ¥è©¢çš„æœ€å¾Œä¸€é“å“è³ªé—œå¡
- ä»£åƒ¹ï¼š
  - é«˜ Token æˆæœ¬
  - è¼ƒé«˜å»¶é²

#### ğŸ”¹ Cohere Rerank v4ï¼ˆè¨—ç®¡å‹ï¼‰
- ä¼æ¥­ç´šé‡æ’åºæ–¹æ¡ˆ
- é—œéµå„ªå‹¢ï¼š
  - 32k Context
  - å¤šèªè¨€ / è·¨èªè¨€
  - çµæ§‹åŒ–è³‡æ–™æ’åº
- æä¾› Pro / Fast é›™ç‰ˆæœ¬ï¼Œå¹³è¡¡æˆæœ¬èˆ‡æ•ˆèƒ½

ğŸ“Œ **æ ¸å¿ƒè§€å¿µ**  
> Re-Rank ä¸æ˜¯è¬éˆä¸¹ï¼Œå®ƒåªå°ã€Œå·²ç¶“æ‰¾å°æ–¹å‘çš„å€™é¸çµæœã€æœ‰æ•ˆã€‚

---

### 2. ç‚ºä»€éº¼éœ€è¦ Hybrid Retrievalï¼Ÿ
å¦‚æœ **ç¬¬ä¸€éšæ®µå°±æ‰¾éŒ¯æ–‡ä»¶**ï¼ŒRe-Rank å†å¼·ä¹Ÿç„¡èƒ½ç‚ºåŠ›ã€‚

å› æ­¤æœ¬ç« æ­£å¼å¼•å…¥ **Hybrid Retrievalï¼ˆæ··åˆå¼æª¢ç´¢ï¼‰**ï¼š

- **BM25ï¼ˆSparse Retrievalï¼‰**
  - ç²¾ç¢ºé—œéµå­—
  - å°ˆæœ‰åè©ã€æ•¸å­—ã€äººåè¡¨ç¾æ¥µä½³
- **FAISSï¼ˆDense Retrievalï¼‰**
  - èªæ„ç†è§£
  - åŒç¾©æ”¹å¯«ã€æ¨¡ç³Šå•é¡Œæ›´å¼·

ğŸ‘‰ çœŸå¯¦ä¸–ç•ŒæŸ¥è©¢ **å¹¾ä¹æ°¸é åŒæ™‚éœ€è¦å…©è€…**

---

### 3. BM25 Retrieverï¼šå›æ­¸ IR åŸºç¤ï¼Œä½†ä¸æ˜¯é€€æ­¥
æœ¬ç« ä»¥ **è‹±æ–‡ Wikipediaï¼ˆTech Companiesï¼‰** ä½œç‚ºç¤ºç¯„è³‡æ–™é›†ï¼Œå°ˆæ³¨æ–¼ BM25 æœ¬èº«çš„æ©Ÿåˆ¶ï¼š

- å¾ Node ç›´æ¥å»ºç«‹ BM25Retriever
- ä½¿ç”¨ DocStoreï¼ˆå¯æ›¿æ›ç‚º MongoDB / Redisï¼‰
- æ”¯æ´ï¼š
  - Stopword Removal
  - Stemming
  - Metadata Filtering

ğŸ“Œ ç‰¹åˆ¥èªªæ˜ï¼š  
> ä¸­æ–‡ BM25 éœ€è¦é«˜åº¦å®¢è£½åŒ–æ–·è©ï¼Œæœ¬é€±åˆ»æ„é¿é–‹å¯¦ä½œç´°ç¯€ï¼Œå°ˆæ³¨åœ¨æª¢ç´¢æ¶æ§‹è¨­è¨ˆã€‚

---

### 4. Hybrid Retrieverï¼ˆBM25 + FAISSï¼‰
æ­£å¼çµ„åˆ Sparse + Dense Retrievalï¼š

- åŒæ™‚åŸ·è¡Œï¼š
  - å‘é‡æœå°‹ï¼ˆFAISSï¼‰
  - é—œéµå­—æœå°‹ï¼ˆBM25ï¼‰
- ä½¿ç”¨ **QueryFusionRetriever** é€²è¡Œçµæœæ•´åˆ
- æ”¯æ´å¤šç¨®èåˆç­–ç•¥ï¼š
  - **Reciprocal Rank Fusionï¼ˆRRFï¼Œé è¨­ï¼‰**
  - Relative Score Fusion
  - Distribution-Based Fusion
  - Simple Fusion

ğŸ“Œ æ ¸å¿ƒå·¥ç¨‹åƒ¹å€¼ï¼š
- æå‡ Recall
- é™ä½å–®ä¸€æª¢ç´¢ç­–ç•¥çš„ç›²é»
- æä¾›æ›´ç©©å®šçš„æ’åºçµæœ

---

### 5. RAG-Fusionï¼šç”¨å¤šå€‹ Query å°æŠ—èªæ„ä¸ç¢ºå®šæ€§
QueryFusionRetriever ä¸åªæ˜¯ã€Œåˆä½µçµæœã€ï¼Œè€Œæ˜¯å®Œæ•´å¯¦ç¾ **RAG-Fusion** æ€æƒ³ï¼š

- ç”± LLM è‡ªå‹•ç”¢ç”Ÿå¤šå€‹ Query Rewrite
- å¾ä¸åŒèªæ„è§’åº¦æª¢ç´¢è³‡æ–™
- ä½¿ç”¨ RRF é™ä½æ’åºåå·®

ğŸ“Œ é—œéµè¨­è¨ˆç†å¿µï¼š  
> ä½¿ç”¨è€…çš„ Query å¹¾ä¹æ°¸é æ˜¯ä¸å®Œæ•´çš„ã€‚

---

### 6. SummaryIndex + IndexNodeï¼šRetrieval Orchestration
æœ¬ç« é€²å…¥ **æª¢ç´¢ç·¨æ’ï¼ˆOrchestrationï¼‰å±¤ç´š**ï¼Œè€Œéå–®ä¸€æª¢ç´¢å™¨ï¼š

- ä½¿ç”¨ `IndexNode` åŒ…è£ï¼š
  - Vector Retriever
  - BM25 Retriever
- ä½¿ç”¨ `SummaryIndex` ä½œç‚º **Router / Orchestrator**
- è®“ LLM åŒæ™‚æ¥æ”¶å¤šç¨®æª¢ç´¢ç­–ç•¥çš„ä¸Šä¸‹æ–‡ä¸¦é€²è¡Œç¶œåˆå›ç­”

ğŸ“Œ SummaryIndex çš„æ­£ç¢ºå®šä½ï¼š
- âœ… å°‘é‡é«˜éšå·¥å…·çš„ç·¨æ’å™¨
- âŒ å¤§é‡æ–‡æª”çš„å„²å­˜ç´¢å¼•

---

## ğŸ§  æ ¸å¿ƒè¨­è¨ˆåŸå‰‡ï¼ˆTakeawaysï¼‰
- **Re-Rank æ˜¯ Precision å·¥å…·ï¼Œä¸æ˜¯ Recall å·¥å…·**
- **Hybrid Retrieval æ˜¯å¯¦å‹™ç³»çµ±çš„æ¨™é…ï¼Œè€Œéé€²éšé¸é …**
- **Query ä¸å¯ä¿¡ï¼Œå¿…é ˆè¢«æ“´å¯«èˆ‡èåˆ**
- **SummaryIndex æ˜¯ã€Œå°‡é ˜ã€ï¼Œä¸æ˜¯ã€Œå£«å…µã€**
- Retrieval æ˜¯ä¸€å€‹ **Pipelineï¼Œè€Œéå–®ä¸€æ­¥é©Ÿ**

---

## ğŸ› ï¸ æŠ€è¡“æ£§
- **Framework**ï¼šLlamaIndex
- **Vector Store**ï¼šFAISS
- **Sparse Retrieval**ï¼šBM25
- **Embedding Models**ï¼šHuggingFace (`BAAI/bge-m3`)
- **Re-Ranker**ï¼š
  - BGE Reranker
  - RankGPT
  - Cohere Rerank v4
- **LLM**ï¼šOpenAI (`gpt-4o-mini`)
- **Language**ï¼šPython

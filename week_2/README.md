# LlamaIndex å¯¦æˆ°ï¼šå¯æŒä¹…åŒ– RAG èˆ‡é€²éšæª¢ç´¢ç­–ç•¥ (Week 2)

æœ¬å°ˆæ¡ˆç´€éŒ„äº†ä½¿ç”¨ **LlamaIndex + FAISS** æ§‹å»ºä¸€å€‹**å¯æŒä¹…åŒ–ï¼ˆPersistentï¼‰ã€å¯æ“´å±•ï¼ˆScalableï¼‰ä¸”é¿å…å¸¸è¦‹å·¥ç¨‹é™·é˜±**çš„ RAGï¼ˆRetrieval-Augmented Generationï¼‰ç³»çµ±çš„å®Œæ•´å¯¦æˆ°æµç¨‹ã€‚  
å…§å®¹ä¸åƒ…æ¶µè“‹ã€Œå¦‚ä½•å¯¦ä½œã€ï¼Œæ›´æ·±å…¥è§£æ **ç‚ºä»€éº¼é€™æ¨£è¨­è¨ˆ**ï¼Œä¸¦ç³»çµ±æ€§èªªæ˜åœ¨å¯¦å‹™ä¸­æœ€å®¹æ˜“å‡ºéŒ¯çš„é—œéµç’°ç¯€ã€‚

---

## ğŸ“… æ›´æ–°è³‡è¨Š
- **åˆç‰ˆæ—¥æœŸ**ï¼š2026.01.06
- **ç­†è¨˜ç‰ˆæœ¬**ï¼šv1.0.0
- **Notebook**ï¼š`week_2.ipynb`ï¼ˆFirst Releaseï¼‰

---

## ğŸš€ æ ¸å¿ƒé‡é»

### 1. æ–‡ä»¶å»ºæ¨¡èˆ‡ Metadata è¨­è¨ˆï¼ˆDocument Layerï¼‰
RAG ç³»çµ±å“è³ªçš„åŸºç¤ä¾†è‡ªæ­£ç¢ºçš„è³‡æ–™å»ºæ¨¡ï¼š
- ä½¿ç”¨ Wikipediaï¼ˆä¸­æ–‡ï¼‰ä½œç‚ºç¤ºç¯„è³‡æ–™ä¾†æºï¼Œæ¨¡æ“¬çœŸå¯¦ä¸–ç•Œçš„éçµæ§‹åŒ–æ–‡æœ¬ã€‚
- ç‚ºæ¯ä»½æ–‡ä»¶è¨­è¨ˆæ˜ç¢ºçš„ **Metadataï¼ˆå¦‚ä½œè€…ï¼‰**ï¼Œä½œç‚ºå¾ŒçºŒæª¢ç´¢èˆ‡éæ¿¾çš„é‡è¦ä¾æ“šã€‚
- èªªæ˜ç‚ºä½• Metadata ä¸¦éè£é£¾ï¼Œè€Œæ˜¯ **Retrieval Strategy çš„ä¸€éƒ¨åˆ†**ã€‚

---

### 2. Chunking èˆ‡ Embeddingï¼šå»ºç«‹ä¸€è‡´çš„èªæ„ç©ºé–“
æ·±å…¥è§£æå‘é‡åŒ–éç¨‹ä¸­çš„æ ¸å¿ƒè¨­è¨ˆåŸå‰‡ï¼š
- **Chunking Strategy**ï¼šä½¿ç”¨ `SentenceSplitter(chunk_size=256)`ï¼Œåœ¨èªæ„å®Œæ•´æ€§èˆ‡æª¢ç´¢ç²¾åº¦ä¹‹é–“å–å¾—å¹³è¡¡ã€‚
- **Embedding Model çš„ä¸å¯æ›¿æ›æ€§**ï¼š
  - Embedding Model å®šç¾©å‘é‡ç¶­åº¦èˆ‡èªæ„ç©ºé–“å¹¾ä½•çµæ§‹ã€‚
  - ç´¢å¼•èˆ‡æŸ¥è©¢å¿…é ˆä½¿ç”¨ **ç›¸åŒçš„ Embedding Model**ï¼Œå¦å‰‡å°‡å°è‡´ç¶­åº¦ä¸åŒ¹é…éŒ¯èª¤ã€‚
- æ¡ç”¨ `BAAI/bge-m3` ä½œç‚ºä¸»è¦å‘é‡æ¨¡å‹ï¼ˆ1024 ç¶­ï¼‰ã€‚

---

### 3. å‘é‡æª¢ç´¢èˆ‡ Metadata Auto-Retrieval
éš¨è³‡æ–™è¦æ¨¡æˆé•·ï¼Œå–®ç´”ç›¸ä¼¼åº¦æœå°‹å°‡é€æ¼¸å¤±æ•ˆï¼š
- **Metadata Filters**ï¼šå…ˆç¸®å°æœå°‹å­ç©ºé–“ï¼Œé™ä½é›œè¨Šã€‚
- **VectorIndexAutoRetriever**ï¼š
  - ç”± LLM æ ¹æ“š Query è‡ªå‹•æ¨æ–·å¯èƒ½çš„ Metadata æ¢ä»¶ã€‚
  - å°‡ Retrieval å¾ã€Œè¢«å‹•æ¯”å°ã€å‡ç´šç‚ºã€Œèªæ„é©…å‹•ç­–ç•¥ã€ã€‚
- å±•ç¤º Query â†’ Metadata æ¨è«– â†’ å‘é‡æœå°‹çš„å®Œæ•´æµç¨‹ã€‚

---

### 4. å‘é‡ç´¢å¼•çš„æŒä¹…åŒ–ï¼ˆPersistenceï¼Œå·¥ç¨‹å¯¦æˆ°é‡é»ï¼‰
æœ¬ç« æ˜¯ Week 2 çš„æ ¸å¿ƒå·¥ç¨‹ä¸»é¡Œï¼š
- æ­£ç¢ºä½¿ç”¨ `StorageContext.persist()` å°‡å‘é‡ã€æ–‡ä»¶èˆ‡ç´¢å¼•çµæ§‹å¯«å…¥ç£ç¢Ÿã€‚
- å¾ç£ç¢Ÿå®‰å…¨é‚„åŸç´¢å¼•çš„æ¨™æº–æµç¨‹ï¼š
  - **é¿å…æ‰‹å‹•å»ºç«‹ç©ºçš„ FAISS index**
  - ç¢ºä¿å‘é‡è³‡æ–™ã€ç´¢å¼•çµæ§‹èˆ‡ Embedding Model å®Œæ•´ä¸€è‡´
- æ·±å…¥è§£æä¸‰å¤§å¸¸è¦‹é™·é˜±ï¼š
  1. **Embedding ç¶­åº¦ä¸åŒ¹é…ï¼ˆDimension Mismatchï¼‰**
  2. **ç©ºç´¢å¼•è¦†è“‹ï¼ˆEmpty Index Overrideï¼‰**
  3. **StorageContext ä¸ä¸€è‡´å°è‡´æŸ¥ä¸åˆ°è³‡æ–™**

---

### 5. Shared Storage Context èˆ‡ Multi-Index ç®¡ç†ï¼ˆé€²éšï¼‰
èªªæ˜åœ¨å–®ä¸€å‘é‡å„²å­˜ç©ºé–“ä¸­ç®¡ç†å¤šå€‹ç´¢å¼•çš„æ­£ç¢ºæ–¹å¼ï¼š
- ç‚ºä»€éº¼æœƒå‡ºç¾ã€Œå¹½éˆç´¢å¼•ï¼ˆGhost Indexï¼‰ã€ã€‚
- `StorageContext` ä½œç‚ºç´¢å¼•ä¸€è‡´æ€§çš„é‚Šç•Œã€‚
- æ­£ç¢ºåŒæ­¥ `index_id` èˆ‡ `index_store`ï¼Œé¿å…ç´¢å¼•çµæ§‹å¤±é…ã€‚
- ä¸€æ¬¡æ€§æŒä¹…åŒ–ï¼ˆPersist Onceï¼‰ä»¥æå‡æ•ˆèƒ½èˆ‡ç©©å®šæ€§ã€‚

---

### 6. Advanced Retrieval Strategies
é‡å°ä¸åŒè³‡æ–™å‹æ…‹èˆ‡æŸ¥è©¢éœ€æ±‚ï¼Œä»‹ç´¹å¤šç¨®é€²éšæª¢ç´¢è¨­è¨ˆï¼š

#### Small-to-Big Retrievalï¼ˆSentence Windowï¼‰
- ä½¿ç”¨ **å–®å¥ embedding** æå‡æª¢ç´¢ç²¾åº¦ã€‚
- é€é Metadata Replacement è£œå›ä¸Šä¸‹æ–‡è¦–çª—ï¼Œå…¼é¡§ç²¾ç¢ºåº¦èˆ‡å¯è®€æ€§ã€‚

#### RecursiveRetriever èˆ‡ IndexNodeï¼ˆéšå±¤å¼æª¢ç´¢ï¼‰
- ä»¥ **æ‘˜è¦ â†’ ç´°ç¯€** çš„æ–¹å¼çµ„ç¹”çŸ¥è­˜ã€‚
- `IndexNode` ä½œç‚ºä¸åŒæŠ½è±¡å±¤ç´šç´¢å¼•ä¹‹é–“çš„æ©‹æ¨‘ã€‚
- `RecursiveRetriever` æ”¯æ´å¤šéšæ®µã€éè¿´å¼çš„æª¢ç´¢æµç¨‹ï¼Œé©ç”¨æ–¼å¤§å‹ã€çµæ§‹åŒ–çŸ¥è­˜åº«ã€‚

---

## ğŸ§  æ ¸å¿ƒè¨­è¨ˆåŸå‰‡ï¼ˆTakeawaysï¼‰
- **Embedding Model â‰  å¯æ›¿æ›é›¶ä»¶**
- **Index â‰  å–®ä¸€ FAISS æª”æ¡ˆ**
- **StorageContext æ˜¯ç´¢å¼•ä¸€è‡´æ€§çš„é‚Šç•Œ**
- **Retrieval Strategy å¿…é ˆéš¨è³‡æ–™è¦æ¨¡èˆ‡çµæ§‹æ¼”é€²**
- RAG æ˜¯ **ç‹€æ…‹å‹ç³»çµ±ï¼ˆStateful Systemï¼‰**ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§è…³æœ¬

---

## ğŸ› ï¸ æŠ€è¡“æ£§
- **Framework**ï¼šLlamaIndex
- **Vector Store**ï¼šFAISS
- **Embedding Models**ï¼šHuggingFace (`BAAI/bge-m3`)
- **LLM**ï¼šOpenAI (`gpt-4o-mini`)
- **Language**ï¼šPython

---

## ğŸ“ å‚™è¨»
This is the **first release** of the `week_2` notebook, focusing on **persistent vector storage, retrieval correctness, and scalable RAG system design**.
